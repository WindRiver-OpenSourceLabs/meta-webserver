The exif_ifd_make_value function in exif.c in the EXIF extension 
in PHP before 5.4.34, 5.5.x before 5.5.18, and 5.6.x before 5.6.2 
operates on floating-point arrays incorrectly, which allows remote 
attackers to cause a denial of service (heap memory corruption and 
application crash) or possibly execute arbitrary code via a crafted 
JPEG image with TIFF thumbnail data that is improperly handled by 
the exif_thumbnail function.

Upstream-Status: Backport [php-5@php.net]

Signed-off-by: Stanislav Malyshev <stas@php.net>

diff -Nur php-5.5.2.orig/ext/exif/exif.c php-5.5.2/ext/exif/exif.c
--- php-5.5.2.orig/ext/exif/exif.c	2013-08-16 04:42:04.000000000 +0800
+++ php-5.5.2/ext/exif/exif.c	2015-01-04 11:19:43.000000000 +0800
@@ -2426,11 +2426,11 @@
 					data_ptr += 8;
 					break;
 				case TAG_FMT_SINGLE:
-					memmove(data_ptr, &info_data->value.f, byte_count);
+					memmove(data_ptr, &info_value->f, 4);
 					data_ptr += 4;
 					break;
 				case TAG_FMT_DOUBLE:
-					memmove(data_ptr, &info_data->value.d, byte_count);
+					memmove(data_ptr, &info_value->d, 8);
 					data_ptr += 8;
 					break;
 			}
diff -Nur php-5.5.2.orig/ext/exif/tests/bug68113.jpg php-5.5.2/ext/exif/tests/bug68113.jpg
--- php-5.5.2.orig/ext/exif/tests/bug68113.jpg 1970-01-01 08:00:00.000000000 +0800
+++ php-5.5.2/ext/exif/tests/bug68113.jpg      2015-01-04 11:24:09.000000000 +0800
new file mode 100755
index 0000000..3ce7a62
Binary php-5.5.2.orig/ext/exif/tests/bug68113.jpg and php-5.5.2/ext/exif/tests/bug68113.jpg differ
@@ -0,0 +1,1 @@
+
diff -Nur php-5.5.2.orig/ext/exif/tests/bug68113.phpt php-5.5.2/ext/exif/tests/bug68113.phpt
--- php-5.5.2.orig/ext/exif/tests/bug68113.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.5.2/ext/exif/tests/bug68113.phpt	2015-01-04 11:24:09.000000000 +0800
@@ -0,0 +1,17 @@
+--TEST--
+Bug #68113 (Heap corruption in exif_thumbnail())
+--SKIPIF--
+<?php
+extension_loaded("exif") or die("skip need exif");
+?>
+--FILE--
+<?php
+var_dump(exif_thumbnail(__DIR__."/bug68113.jpg"));
+?>
+Done
+--EXPECTF--
+Warning: exif_thumbnail(bug68113.jpg): File structure corrupted in %s/bug68113.php on line 2
+
+Warning: exif_thumbnail(bug68113.jpg): Invalid JPEG file in %s/bug68113.php on line 2
+bool(false)
+Done
